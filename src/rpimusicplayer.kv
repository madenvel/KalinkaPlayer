#:kivy 2.2.1

<BackgroundProgressBar@Widget>:
    progress_color: (0, 0, 1, 1)
    max: 100
    value: 0
    canvas.before:
        Color:
            rgba: root.progress_color
        Rectangle:
            size: self.size[0] * (root.value / root.max), self.size[1]
            pos: self.pos
            
<BackgroundProgressBarBoxLayout@BackgroundProgressBar+BoxLayout>:
    progress_color: (0, 0, 1, 1)
    max: 100
    value: 0
        

<RpiPlaybar>:
    orientation: 'horizontal'
    AsyncImage:
        source: root.album_image
        size_hint: None, None
        size: root.height, root.height
    BackgroundProgressBarBoxLayout:
        id: progressbar
        orientation:'horizontal'
        max: 100
        value: self.max * (root.current_time / root.duration if root.duration != 0 else 0)
        progress_color: (50/255, 72/255, 171/255, 1)
        BoxLayout:
            orientation:'vertical'
            Label:
                text: '[b]' + root.title + '[/b]'
                size_hint_x: None
                width: self.texture_size[0]
                pos_hint: {'center_x': 0.5}
                font_size: "18sp"
                markup: True
            Label:
                text: root.performer
                size_hint_x: None
                width: self.texture_size[0]
                pos_hint: {'center_x': 0.5}
                font_size: "16sp"
                markup: True
        Label:
            id: time_passed
            text: root.format_time(root.current_time) + ' / ' + root.format_time(root.duration)
            size_hint_x: None
            width: self.texture_size[0]
            padding: 5
    Button:
        on_press: root.on_play()
        text: "Play" if root.playing_state != 1 else "Pause"
        size_hint_x: None
        width: root.height

<RpiPlayingNow>:
    RelativeLayout:
        id: layout
        orientation: 'vertical'
        spacing: 10
        AsyncImage:
            id: image
            source: root.album_image
            on_touch_down: root.on_touch_down(args[1])
            on_touch_up: root.on_touch_up(args[1])
            on_touch_move: root.on_touch_move(args[1])
        Image:
            id: prev_image
            source: 'assets/previous.png'
            color: (1, 1, 1, 0)
        Image:
            id: next_image
            source: 'assets/next.png'
            color: (1, 1, 1, 0)

<RpiPlayQueue>:
    RecycleView:
        id: rv
        viewclass: 'TrackListItem'
        RecycleBoxLayout:
            default_size: None, dp(85)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height
            orientation: 'vertical'
            LineSeparator:
                color: (0.81, 0.81, 0.81, 1.0)
                size_hint: None, None
                width: root.width
                height: 5

<RpiBrowser>:
    id: browse_tab
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        TextInput:
            id: input
            hint_text: 'Enter something'
            size_hint: 1, None
            height: 36
            multiline: False
            on_text_validate: root.on_enter()
        RecycleView:
            id: rv
            viewclass: 'TrackListItem'
            RecycleBoxLayout:
                default_size: None, dp(85)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                LineSeparator:
                    color: (0.81, 0.81, 0.81, 1.0)
                    size_hint: None, None
                    width: root.width
                    height: 5

<BackgroundColor@Widget>:
    background_color: (1, 1, 1, 1)
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos

<BackgroundLabel@Label+BackgroundColor>:
    background_color: (0, 0, 0, 0)

<BackgroundBoxLayout@BoxLayout+BackgroundColor>:
    background_color: (0, 0, 0, 0)

<LineSeparator@Widget>:
    color: (1, 1, 1, 1)
    canvas.after:
        Color:
            rgba: root.color
        Line:
            points: [(self.pos[0], self.pos[1]), (self.pos[0] + self.size[0], self.pos[1])]
            width: 1


<TrackListItem@ButtonBehavior+BoxLayout>:
    selected: False
    image: {"small": ""}
    title: ""
    performer: ""
    selected: 0
    index: 0
    orientation: 'vertical'
    on_press: root.on_item_clicked(root.index)
    BoxLayout:
        orientation: "horizontal"
        spacing: 10
        padding: (10, 0, 0, 0)
        AsyncImage:
            source: root.image["small"]
            size_hint: None, None
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            width: 64
            height: 64
        BoxLayout:
            orientation:"vertical"
            Label:
                background_color: (1, 0, 0, 1)
                text: "[b][color=d0d0d0]" + root.title + '[/b]'
                valign: "bottom"
                text_size: self.size
                halign: "left"
                font_size: "18sp"
                markup: True
            Label:
                background_color: (0, 1, 0, 1)
                text: "[color=d0d0d0]" + root.performer
                valign: "top"
                text_size: self.size
                halign: "left"
                font_size: "16sp"
                markup: True
            LineSeparator:
                color: (0.81, 0.81, 0.81, 1.0)
                size_hint: 1.0, None
                height: 5
        Image:
            source: 'assets/pause.png' if root.selected == 1 else 'assets/transparent.png'
            size_hint: None, None
            size: 64, 64
            color: (0.8125, 0.8125, 0.8125, 1.0)

<RpiMainScreen>:
    orientation: 'horizontal'
    BoxLayout:
        orientation: 'vertical'

        TabbedPanel:
            size_hint_x: None
            width: root.width
            pos_hint: {'left': 0, 'top': 0}
            do_default_tab: False
            tab_pos: 'top_left'
            RpiPlayingNow:
                size_hint_y: 1
                text: "Now Playing"
            RpiPlayQueue:
                size_hint_y: 1
                text: "Queue"
                size: root.size
            RpiBrowser:
                size: root.size
                text: "Browse"
        RpiPlaybar:
            size_hint: None, None
            size: root.width, 64
            
            


